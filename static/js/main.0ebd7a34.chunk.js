(this["webpackJsonp2005-crowdstrike-adversary"]=this["webpackJsonp2005-crowdstrike-adversary"]||[]).push([[0],{123:function(e,t,a){},262:function(e,t,a){},263:function(e,t,a){"use strict";a.r(t);var n=a(8),r=a(0),i=a.n(r),o=a(109),s=a.n(o),c=(a(123),a(75)),d=a(22),h=(a(261),a(3)),l=a(4),u=a(74),v=a(113),g=a(1),f=a(5),m=a(2),b=a(114),p=a(115);function j(){var e=Object(u.a)(["\nuniform vec3 colorLight;\nuniform vec3 colorDark;\nuniform float crush;\nuniform bool enabled;\n\nuniform sampler2D tDiffuse;\nvarying vec2 vUv;\n\nvoid main() {\n  vec4 baseColor = texture2D( tDiffuse, vUv );\n\n  if (enabled) {\n    float grey = dot(baseColor.rgb, vec3(0.299, 0.587, 0.114));\n    grey = smoothstep(crush, 1.0 - crush, grey);\n\n    vec3 outColor = mix(colorDark, colorLight, grey);\n\n    gl_FragColor = vec4(outColor, 1.0);\n  } else {\n    gl_FragColor = baseColor;\n  }\n}\n"]);return j=function(){return e},e}function w(){var e=Object(u.a)(["\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"]);return w=function(){return e},e}var x=function(){function e(t,a){var n=this;Object(g.a)(this,e),this.canvas=t,this.state=a,this.renderer=void 0,this.scene=void 0,this.camera=void 0,this.controls=void 0,this.adversary=void 0,this.adversaryMaterial=void 0,this.timeStarted=0,this.geom=new m.n(200,200,512,512),this.textureBase=void 0,this.duotoneEffect=void 0,this.ambientLight=void 0,this.directionalLight=void 0,this.handleWindowResize=function(){n.renderer.setSize(window.innerWidth,window.innerHeight),n.camera.aspect=window.innerWidth/window.innerHeight,n.camera.updateProjectionMatrix()},this.animate=function(){var e,t,a,r;requestAnimationFrame(n.animate),n.controls.update(),null!=n.adversaryMaterial&&(n.adversaryMaterial.displacementScale=(t=0,a=5e3,r=performance.now()-n.timeStarted,(r=m.h.clamp((r-t)/(a-t),0,1))*r*(3-2*r)*n.state.growLength)),null!=n.textureBase&&(n.textureBase.needsUpdate=!0),null===(e=n.duotoneEffect)||void 0===e||e.render(n.renderer),n.renderer.render(n.scene,n.camera)},this.renderer=new m.y({canvas:t}),this.renderer.setPixelRatio(window.devicePixelRatio),this.scene=new m.p,this.camera=new m.l(75,window.innerWidth/window.innerHeight,1,2e3),this.camera.position.set(150,0,150),this.camera.lookAt(0,0,0),this.handleWindowResize(),window.addEventListener("resize",this.handleWindowResize),this.ambientLight=new m.a,this.scene.add(this.ambientLight),this.directionalLight=new m.d,this.directionalLight.position.set(0,0,10),this.scene.add(this.directionalLight),this.scene.background=new m.c(1,1,1),this.loadDefaultImage(),this.controls=new b.a(this.camera,this.canvas),this.controls.autoRotate=!0,this.setState(a),requestAnimationFrame(this.animate)}return Object(f.a)(e,[{key:"setImage",value:function(e){var t=new m.t(e);e.onload=function(){t.needsUpdate=!0},this.recreateAdversary(t)}},{key:"setState",value:function(e){var t;this.state=e,null===(t=this.duotoneEffect)||void 0===t||t.material.update(e),null!=this.adversaryMaterial&&(e.duoToneEnabled?this.adversaryMaterial.map=this.duotoneEffect.texture:this.adversaryMaterial.map=this.textureBase,this.adversaryMaterial.needsUpdate=!0),this.ambientLight.color.set(e.ambientLight),this.directionalLight.color.set(e.directionalLight),this.scene.background.set(e.background)}},{key:"recreateAdversary",value:function(e){var t;null!=this.adversary&&(this.scene.remove(this.adversary),null===(t=this.adversaryMaterial)||void 0===t||t.dispose());this.textureBase=e,this.duotoneEffect=new y(e,this.state);var a=this.createDisplacementMap(e);this.adversaryMaterial=new m.j({side:m.e,map:this.duotoneEffect.texture,displacementMap:a,displacementScale:0,roughness:1,metalness:0}),this.state.duoToneEnabled?this.adversaryMaterial.map=this.duotoneEffect.texture:this.adversaryMaterial.map=this.textureBase,this.adversary=new m.i(this.geom,this.adversaryMaterial),this.scene.add(this.adversary),this.renderer.render(this.scene,this.camera),this.timeStarted=performance.now()}},{key:"loadDefaultImage",value:function(){var e=this;(new m.u).load("/2005-crowdstrike-adversary/adversaries/Buffalo.jpg",(function(t){e.recreateAdversary(t)}),(function(e){return console.log(e)}),(function(e){return console.error(e)}))}},{key:"createDisplacementMap",value:function(e){var t=e.image,a=document.createElement("canvas");a.width=t.width/3,a.height=t.height/3;var n=a.getContext("2d");if(n){n.drawImage(t,0,0,a.width,a.height);for(var r=a.width,i=a.height,o=n.getImageData(0,0,r,i),s=0;s<o.data.length;s+=4){var c=.2126*(o.data[s]/255)+.7152*(o.data[s+1]/255)+.0722*(o.data[s+2]/255);o.data[s]=o.data[s+1]=o.data[s+2]=Math.floor(255*c)}return n.putImageData(o,0,0),new m.b(a)}}},{key:"generateDisplacementMappedGeometry",value:function(e){var t=document.createElement("canvas");t.width=e.width/10,t.height=e.height/10;var a=t.getContext("2d");if(a){a.drawImage(e,0,0,t.width,t.height);var n,r=t.width,i=t.height,o=a.getImageData(0,0,r,i),s=new m.n(r-1,i-1,r-1,i-1),c=Object(v.a)(s.vertices);try{for(c.s();!(n=c.n()).done;){var d=n.value,h=4*(m.h.mapLinear(d.x-.5,-r/2,r/2,0,r)+r*m.h.mapLinear(d.y-.5,i/2,-i/2,0,i)),l=.2126*(o.data[h]/255)+.7152*(o.data[h+1]/255)+.0722*(o.data[h+2]/255);d.z=20*l}}catch(g){c.e(g)}finally{c.f()}var u=200/Math.max(r,i);return s.scale(u,u,1),s.computeFlatVertexNormals(),s}}}]),e}(),y=function(){function e(t,a){Object(g.a)(this,e),this.source=t,this.target=void 0,this.fsQuad=void 0,this.material=void 0,this.target=new m.x(t.image.width,t.image.height),this.material=new D(a),this.fsQuad=new p.a.FullScreenQuad(this.material)}return Object(f.a)(e,[{key:"texture",get:function(){return this.target.texture}}]),Object(f.a)(e,[{key:"render",value:function(e){e.setRenderTarget(this.target),this.fsQuad.render(e),e.setRenderTarget(null)}}]),e}();function O(e){for(var t="",a=0;a<(arguments.length<=1?0:arguments.length-1);a++)t+=e[a],t+=a+1<1||arguments.length<=a+1?void 0:arguments[a+1];return t+=e[e.length-1]}var L=O(w()),k=O(j()),D=function(e){Object(h.a)(a,e);var t=Object(l.a)(a);function a(e){var n;return Object(g.a)(this,a),(n=t.call(this,{uniforms:{colorLight:{value:new m.c(e.duoToneLight)},colorDark:{value:new m.c(e.duoToneDark)},crush:{value:0},enabled:{value:!0}},vertexShader:L,fragmentShader:k})).needsUpdate=!0,n}return Object(f.a)(a,[{key:"update",value:function(e){this.uniforms.colorLight.value.set(e.duoToneLight),this.uniforms.colorDark.value.set(e.duoToneDark),this.uniforms.enabled.value=e.duoToneEnabled,this.needsUpdate=!0}}]),a}(m.q),E=function(e){var t=e.img,a=e.state,o=Object(r.useRef)(),s=i.a.useCallback((function(e){null!=e&&(o.current=new x(e,a))}),[]);return Object(r.useEffect)((function(){null!=o.current&&null!=t&&o.current.setImage(t)}),[t]),Object(r.useEffect)((function(){null!=o.current&&o.current.setState(a)}),[a]),Object(n.jsx)("canvas",{ref:s})},M=(a(262),a(51)),T=a(117),S=function(e){var t=e.onGotImage,a=Object(r.useCallback)((function(e,a,n){e.forEach((function(e){var a=new FileReader;a.onabort=function(){return console.log("file reading was aborted")},a.onerror=function(){return console.log("file reading has failed")},a.onload=function(){var e=document.createElement("img");e.src=a.result,t(e)},a.readAsDataURL(e)}))}),[t]),i=Object(T.a)({onDrop:a,maxFiles:1}),o=i.getRootProps,s=i.getInputProps,c=i.isDragActive;return Object(n.jsxs)("div",Object(M.a)(Object(M.a)({className:"dropzone"},o()),{},{children:[Object(n.jsx)("input",Object(M.a)({},s())),c?Object(n.jsx)("p",{children:"Drop the files here ..."}):Object(n.jsx)("p",{children:"Drag 'n' drop some files here, or click to select files"})]}))};var C=function(){var e=Object(r.useState)(),t=Object(c.a)(e,2),a=t[0],i=t[1],o=Object(r.useState)({background:"#ffffff",growLength:50,ambientLight:"#535353",directionalLight:"#d2d2d2",duoToneEnabled:!0,duoToneLight:"#317671",duoToneDark:"#772E49"}),s=Object(c.a)(o,2),h=s[0],l=s[1];return Object(n.jsxs)("div",{className:"App",children:[Object(n.jsx)(E,{img:a,state:h}),Object(n.jsx)(S,{onGotImage:i}),Object(n.jsxs)(d.e,{data:h,onUpdate:l,children:[Object(n.jsx)(d.b,{path:"background",label:"Background"}),Object(n.jsx)(d.b,{path:"ambientLight",label:"Ambient Light"}),Object(n.jsx)(d.b,{path:"directionalLight",label:"Directional Light"}),Object(n.jsx)(d.d,{path:"growLength",label:"Grow Length",min:0,max:999,step:10}),Object(n.jsxs)(d.c,{closed:!1,title:"Duo Tone",children:[Object(n.jsx)(d.a,{path:"duoToneEnabled",label:"Duo Tone Enabled?"}),Object(n.jsx)(d.b,{path:"duoToneLight",label:"Duo Tone Light"}),Object(n.jsx)(d.b,{path:"duoToneDark",label:"Duo Tone Dark"})]})]})]})},I=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,264)).then((function(t){var a=t.getCLS,n=t.getFID,r=t.getFCP,i=t.getLCP,o=t.getTTFB;a(e),n(e),r(e),i(e),o(e)}))};s.a.render(Object(n.jsx)(i.a.StrictMode,{children:Object(n.jsx)(C,{})}),document.getElementById("root")),I()}},[[263,1,2]]]);
//# sourceMappingURL=main.0ebd7a34.chunk.js.map