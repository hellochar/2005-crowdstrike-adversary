(this["webpackJsonp2005-crowdstrike-adversary"]=this["webpackJsonp2005-crowdstrike-adversary"]||[]).push([[0],{123:function(e,t,a){},262:function(e,t,a){},263:function(e,t,a){"use strict";a.r(t);var n=a(8),i=a(0),r=a.n(i),s=a(109),o=a.n(s),c=(a(123),a(75)),l=a(22),h=(a(261),a(113)),d=a(1),u=a(5),g=a(2),v=a(114),m=a(3),f=a(4),p=function(){function e(t,a,n){Object(d.a)(this,e),this.x=t,this.y=a,this.z=n}return Object(u.a)(e,[{key:"dot2",value:function(e,t){return this.x*e+this.y*t}},{key:"dot3",value:function(e,t,a){return this.x*e+this.y*t+this.z*a}}]),e}(),w=[new p(1,1,0),new p(-1,1,0),new p(1,-1,0),new p(-1,-1,0),new p(1,0,1),new p(-1,0,1),new p(1,0,-1),new p(-1,0,-1),new p(0,1,1),new p(0,-1,1),new p(0,1,-1),new p(0,-1,-1)],b=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],y=new Array(512),j=new Array(512);!function(e){e>0&&e<1&&(e*=65536),(e=Math.floor(e))<256&&(e|=e<<8);for(var t=0;t<256;t++){var a;a=1&t?b[t]^255&e:b[t]^e>>8&255,y[t]=y[t+256]=a,j[t]=j[t+256]=w[a%12]}}(0);Math.sqrt(3),Math.sqrt(3);function x(e){return e*e*e*(e*(6*e-15)+10)}function O(e,t,a){return(1-a)*e+a*t}function M(e,t){var a=Math.floor(e),n=Math.floor(t);e-=a,t-=n;var i=j[(a&=255)+y[n&=255]].dot2(e,t),r=j[a+y[n+1]].dot2(e,t-1),s=j[a+1+y[n]].dot2(e-1,t),o=j[a+1+y[n+1]].dot2(e-1,t-1),c=x(e);return O(O(i,s,c),O(r,o,c),x(t))}function C(e,t,a){return(a=g.g.clamp((a-e)/(t-e),0,1))*a*(3-2*a)}var k=function(e){Object(m.a)(a,e);var t=Object(f.a)(a);function a(e){var n;return Object(d.a)(this,a),(n=t.call(this,function(e){for(var t=new g.e,a=R(e.image,128).imageData,n=a.width,i=a.height,r=0;r<n;r++)for(var s=0;s<i;s++){var o=g.g.mapLinear(r+.5,0,n,-n/2,n/2),c=g.g.mapLinear(s+.5,0,i,i/2,-i/2),l=4*(r+n*s),h=a.data[l]/255,d=a.data[l+1]/255,u=a.data[l+2]/255,v=50*(.2126*h+.7152*d+.0722*u);t.vertices.push(new g.w(o,c,v)),t.colors.push(new g.c(h,d,u))}var m=200/Math.max(n,i);return t.scale(m,m,1),console.log(t),t}(e),function(){var e=(new g.u).load("/2005-crowdstrike-adversary/textures/disc.png");e.onUpdate=function(){return t.needsUpdate=!0};var t=new g.n({vertexColors:!0,map:e,transparent:!0,alphaTest:.2,sizeAttenuation:!0,size:6});return t}())).source=e,n.geom=void 0,n.originalPositions=void 0,n.originalColors=void 0,n.mat=void 0,n.geom=n.geometry,n.mat=n.material,n.originalPositions=n.geom.vertices.map((function(e){return e.clone()})),n.originalColors=n.geom.colors.map((function(e){return e.clone()})),n}return Object(u.a)(a,[{key:"animate",value:function(){for(var e=performance.now()/1e3,t=e%10<5?"mainnav":"heightmap",a=0;a<this.geom.vertices.length;a++){if("heightmap"===t)this.animateHeightmap(a,e);else switch(W.particleDistortion){case"messycircle":this.animateCircleMessy(a,e);break;case"noiseflow":this.animateNoiseflow(a,e);break;case"sphere":this.animateSphere(a,e)}var n=this.geom.vertices[a],i=this.geom.colors[a];n.lerp(B,.2),i.lerp(S,.15)}this.geom.colorsNeedUpdate=!0,this.geom.verticesNeedUpdate=!0}},{key:"animateSphere",value:function(e,t){this.geom.vertices[e],this.geom.colors[e];var a=this.originalPositions[e],n=(this.originalColors[e],a.x),i=a.y,r=(Math.atan2(i,n),Math.sqrt(1e4-n*n-i*i));B.set(n,i,r)}},{key:"animateNoiseflow",value:function(e,t){this.geom.vertices[e],this.geom.colors[e];var a=this.originalPositions[e],n=(this.originalColors[e],M(a.x/20,a.y/20+.5*t-4.213)),i=M(a.x/20+1e3,a.y/20+.5*t+26.586),r=M(a.x/20+9903,a.y/20-200+.5*t+90.492);B.set(a.x+50*n,a.y+50*i,50*r),S.setRGB(.92,.91,.93)}},{key:"animateCircleMessy",value:function(e,t){this.geom.vertices[e],this.geom.colors[e],this.originalPositions[e],this.originalColors[e];var a=Math.atan2(this.originalPositions[e].y,this.originalPositions[e].x);B.set(80*Math.cos(a)+6*M(e/10,t)-3,80*Math.sin(a)+6*M(e/10+1.953,t+399)-3,this.originalPositions[e].z+50+50*Math.sin(24*a+2.5*t))}},{key:"animateHeightmap",value:function(e,t){var a=this.geom.vertices[e],n=(this.geom.colors[e],this.originalPositions[e]),i=this.originalColors[e];B.set(n.x,n.y,n.z+1*Math.sin(a.x/4+a.y/7+.5*t)),S.set(i)}}]),a}(g.m);var B=new g.w,S=new g.c;var D=a(74),E=a(115);function A(){var e=Object(D.a)(["\nuniform sampler2D tSource;\nuniform vec3[10] gradient;\nuniform int gradientLength;\nuniform bool transparency;\nuniform bool enabled;\nuniform float maxBrightness;\nuniform float minBrightness;\n\nvarying vec2 vUv;\n\nvec4 getGradientColor(float t) {\n  float tOnGradient = t * float(gradientLength);\n  int lowStop = int(tOnGradient);\n  int highStop = int(tOnGradient) + 1;\n  float lerpAmount = tOnGradient - float(lowStop);\n\n  vec3 colorLow = gradient[lowStop];\n  vec3 colorHigh = gradient[highStop];\n\n  float alpha = 1.0;\n  if (transparency && lowStop == 0) {\n    alpha = lerpAmount;\n  }\n\n  return vec4(mix(colorLow, colorHigh, lerpAmount), alpha);\n}\n\nvoid main() {\n  vec4 baseColor = texture2D( tSource, vUv );\n\n  if (enabled) {\n    float brightness = dot(baseColor.rgb, vec3(0.299, 0.587, 0.114));\n    float normalizedBrightness = smoothstep(minBrightness, maxBrightness, brightness);\n\n    vec4 outColor = getGradientColor(normalizedBrightness);\n\n    gl_FragColor = outColor;\n  } else {\n    gl_FragColor = baseColor;\n  }\n}\n"]);return A=function(){return e},e}function F(){var e=Object(D.a)(["\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"]);return F=function(){return e},e}var L=function(){function e(t,a,n,i){Object(d.a)(this,e),this.source=t,this.maxBrightness=n,this.minBrightness=i,this.target=void 0,this.fsQuad=void 0,this.material=void 0,this.target=new g.x(t.image.width,t.image.height),this.material=new P(t,a,n,i),this.fsQuad=new E.a.FullScreenQuad(this.material)}return Object(u.a)(e,[{key:"texture",get:function(){return this.target.texture}}]),Object(u.a)(e,[{key:"render",value:function(e){e.setRenderTarget(this.target),this.fsQuad.render(e),e.setRenderTarget(null)}}]),e}(),P=function(e){Object(m.a)(a,e);var t=Object(f.a)(a);function a(e,n,i,r){var s;return Object(d.a)(this,a),(s=t.call(this,{uniforms:{tSource:{value:e},gradient:{value:new Array(10).fill(0).map((function(){return new g.c}))},gradientLength:{value:0},transparency:{value:!0},enabled:{value:!0},maxBrightness:{value:i},minBrightness:{value:r}},vertexShader:z,fragmentShader:G,transparent:!0})).update(n),s.needsUpdate=!0,s}return Object(u.a)(a,[{key:"update",value:function(e){var t=this,a=e.gradient.split(" ").map((function(e){return new g.c(e)})),n=a.length;a.forEach((function(e,a){t.uniforms.gradient.value[a]=e})),this.uniforms.gradientLength.value=n,this.uniforms.transparency.value=e.gradientTransparency,this.uniforms.enabled.value=e.gradientEnabled,this.needsUpdate=!0}}]),a}(g.q),z=U(F()),G=U(A());function U(e){for(var t="",a=0;a<(arguments.length<=1?0:arguments.length-1);a++)t+=e[a],t+=a+1<1||arguments.length<=a+1?void 0:arguments[a+1];return t+=e[e.length-1]}var I=function(){function e(t,a){var n=this;Object(d.a)(this,e),this.canvas=t,this.state=a,this.renderer=void 0,this.scene=void 0,this.camera=void 0,this.controls=void 0,this.adversary=void 0,this.adversaryMaterial=void 0,this.timeStarted=0,this.geom=new g.l(200,200,512,512),this.textureBase=void 0,this.gradientEffect=void 0,this.pointCloud=void 0,this.maxBrightness=void 0,this.minBrightness=void 0,this.handleWindowResize=function(){n.renderer.setSize(window.innerWidth,window.innerHeight);var e=window.innerWidth/window.innerHeight,t=100;n.camera.left=-100*e,n.camera.right=t*e,n.camera.top=t,n.camera.bottom=-100,n.camera.updateProjectionMatrix()},this.animate=function(){var e,t,a;if(requestAnimationFrame(n.animate),n.controls.update(),null!=n.adversaryMaterial&&null!=n.adversary){var i=C(0,5e3,performance.now()-n.timeStarted)*n.state.growLength/n.maxBrightness;n.adversaryMaterial.displacementScale=i,n.adversary.position.z=-i/2}"particles"===n.state.mode&&(null===(a=n.pointCloud)||void 0===a||a.animate());null===(e=n.gradientEffect)||void 0===e||e.material.update(n.state),null===(t=n.gradientEffect)||void 0===t||t.render(n.renderer),n.renderer.render(n.scene,n.camera)},this.renderer=new g.y({canvas:t}),this.renderer.setPixelRatio(window.devicePixelRatio),this.scene=new g.p,this.camera=new g.j(-1,1,1,-1,-9999,9999),this.camera.position.set(0,0,100),this.camera.lookAt(0,0,0),this.handleWindowResize(),window.addEventListener("resize",this.handleWindowResize),this.scene.add(new g.a(16777215)),this.scene.background=new g.c(1,1,1),this.loadDefaultImage(),this.controls=new v.a(this.camera,this.canvas),this.setState(a),requestAnimationFrame(this.animate)}return Object(u.a)(e,[{key:"setImage",value:function(e){var t=new g.t(e);e.onload=function(){t.needsUpdate=!0},this.recreateAdversary(t)}},{key:"setState",value:function(e){var t;this.state=e,null===(t=this.gradientEffect)||void 0===t||t.material.update(e),null!=this.adversaryMaterial&&(e.gradientEnabled?this.adversaryMaterial.map=this.gradientEffect.texture:this.adversaryMaterial.map=this.textureBase,this.adversaryMaterial.needsUpdate=!0),this.scene.background.set(e.background),"heightmap"===e.mode&&null!=this.adversary&&null==this.adversary.parent?(this.scene.add(this.adversary),this.pointCloud&&this.scene.remove(this.pointCloud)):"particles"===e.mode&&null!=this.pointCloud&&null==this.pointCloud.parent&&(this.scene.add(this.pointCloud),this.adversary&&this.scene.remove(this.adversary))}},{key:"recreateAdversary",value:function(e){var t;null!=this.adversary&&(this.scene.remove(this.adversary),null===(t=this.adversaryMaterial)||void 0===t||t.dispose());null!=this.pointCloud&&this.scene.remove(this.pointCloud),this.textureBase=e;var a=this.createDisplacementMap(e),n=a.texture,i=a.maxBrightness,r=a.minBrightness;this.maxBrightness=i,this.minBrightness=r,this.gradientEffect=new L(e,this.state,i,r),this.adversaryMaterial=new g.i({map:this.gradientEffect.texture,displacementMap:n,displacementScale:0,transparent:!0,roughness:1,metalness:0}),this.state.gradientEnabled?this.adversaryMaterial.map=this.gradientEffect.texture:this.adversaryMaterial.map=this.textureBase,this.adversary=new g.h(this.geom,this.adversaryMaterial),this.pointCloud=new k(e),"heightmap"===this.state.mode?this.scene.add(this.adversary):this.scene.add(this.pointCloud),this.renderer.render(this.scene,this.camera),this.timeStarted=performance.now()}},{key:"loadDefaultImage",value:function(){var e=this;(new g.u).load("/2005-crowdstrike-adversary/adversaries/Buffalo.jpg",(function(t){e.recreateAdversary(t)}),(function(e){return console.log(e)}),(function(e){return console.error(e)}))}},{key:"createDisplacementMap",value:function(e){for(var t=R(e.image,256),a=t.imageData,n=t.canvas,i=0,r=1,s=0;s<a.data.length;s+=4){var o=.2126*(a.data[s]/255)+.7152*(a.data[s+1]/255)+.0722*(a.data[s+2]/255);i=Math.max(o,i),r=Math.min(o,r),a.data[s]=a.data[s+1]=a.data[s+2]=o}return{texture:new g.b(n),imageData:a,maxBrightness:i,minBrightness:r}}},{key:"generateDisplacementMappedGeometry",value:function(e){var t=document.createElement("canvas");t.width=e.width/10,t.height=e.height/10;var a=t.getContext("2d");if(a){a.drawImage(e,0,0,t.width,t.height);var n,i=t.width,r=t.height,s=a.getImageData(0,0,i,r),o=new g.l(i-1,r-1,i-1,r-1),c=Object(h.a)(o.vertices);try{for(c.s();!(n=c.n()).done;){var l=n.value,d=4*(g.g.mapLinear(l.x-.5,-i/2,i/2,0,i)+i*g.g.mapLinear(l.y-.5,r/2,-r/2,0,r)),u=.2126*(s.data[d]/255)+.7152*(s.data[d+1]/255)+.0722*(s.data[d+2]/255);l.z=20*u}}catch(m){c.e(m)}finally{c.f()}var v=200/Math.max(i,r);return o.scale(v,v,1),o.computeFlatVertexNormals(),o}}}]),e}();function R(e,t){var a=document.createElement("canvas"),n=e.height/e.width*t;a.width=t,a.height=n;var i=a.getContext("2d");return i.drawImage(e,0,0,t,n),{canvas:a,imageData:i.getImageData(0,0,t,n)}}var T=function(e){var t=e.img,a=e.state,s=Object(i.useRef)(),o=r.a.useCallback((function(e){null!=e&&(s.current=new I(e,a))}),[]);return Object(i.useEffect)((function(){null!=s.current&&null!=t&&s.current.setImage(t)}),[t]),Object(i.useEffect)((function(){null!=s.current&&s.current.setState(a)}),[a]),Object(n.jsx)("canvas",{ref:o})},N=(a(262),a(51)),q=a(117),H=function(e){var t=e.onGotImage,a=Object(i.useCallback)((function(e,a,n){e.forEach((function(e){var a=new FileReader;a.onabort=function(){return console.log("file reading was aborted")},a.onerror=function(){return console.log("file reading has failed")},a.onload=function(){var e=document.createElement("img");e.src=a.result,t(e)},a.readAsDataURL(e)}))}),[t]),r=Object(q.a)({onDrop:a,maxFiles:1}),s=r.getRootProps,o=r.getInputProps,c=r.isDragActive;return Object(n.jsxs)("div",Object(N.a)(Object(N.a)({className:"dropzone"},s()),{},{children:[Object(n.jsx)("input",Object(N.a)({},o())),c?Object(n.jsx)("p",{children:"Drop the files here ..."}):Object(n.jsx)("p",{children:"Drag 'n' drop some files here, or click to select files"})]}))},W={mode:"heightmap",particleDistortion:"noiseflow",background:"#ffffff",growLength:50,gradientEnabled:!0,gradient:"#131B1D #31474D #FC0000 #ABABAB #FFFFFF",gradientTransparency:!0};var Q=function(){var e=Object(i.useState)(),t=Object(c.a)(e,2),a=t[0],r=t[1],s=Object(i.useState)(W),o=Object(c.a)(s,2),h=o[0],d=o[1];return Object(i.useEffect)((function(){Object.assign(W,h)}),[h]),Object(n.jsxs)("div",{className:"App",children:[Object(n.jsx)(T,{img:a,state:h}),Object(n.jsx)(H,{onGotImage:r}),Object(n.jsxs)(l.g,{data:h,onUpdate:d,children:[Object(n.jsx)(l.e,{path:"mode",label:"Mode",options:["heightmap","particles"]}),Object(n.jsx)(l.e,{path:"particleDistortion",label:"Particle Distortion",options:["noiseflow","sphere","messycircle"]}),Object(n.jsx)(l.b,{path:"background",label:"Background"}),Object(n.jsx)(l.d,{path:"growLength",label:"Grow Length",min:0,max:999,step:10}),Object(n.jsxs)(l.c,{closed:!1,title:"Gradient",children:[Object(n.jsx)(l.a,{path:"gradientEnabled",label:"Gradient Enabled?"}),Object(n.jsx)(l.f,{path:"gradient",label:"Gradient"}),Object(n.jsx)(l.a,{path:"gradientTransparency",label:"Transparency?"})]})]})]})},_=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,264)).then((function(t){var a=t.getCLS,n=t.getFID,i=t.getFCP,r=t.getLCP,s=t.getTTFB;a(e),n(e),i(e),r(e),s(e)}))};o.a.render(Object(n.jsx)(r.a.StrictMode,{children:Object(n.jsx)(Q,{})}),document.getElementById("root")),_()}},[[263,1,2]]]);
//# sourceMappingURL=main.21313093.chunk.js.map