(this["webpackJsonp2005-crowdstrike-adversary"]=this["webpackJsonp2005-crowdstrike-adversary"]||[]).push([[0],{123:function(e,t,a){},262:function(e,t,a){},263:function(e,t,a){"use strict";a.r(t);var i=a(8),n=a(0),r=a.n(n),o=a(109),s=a.n(o),c=(a(123),a(75)),d=a(16),h=(a(261),a(3)),l=a(4),u=a(74),v=a(113),g=a(1),m=a(5),f=a(2),p=a(114),b=a(115);function w(){var e=Object(u.a)(["\nuniform vec3 colorLight;\nuniform vec3 colorDark;\nuniform float crush;\nuniform bool enabled;\n\nuniform sampler2D tSource;\nvarying vec2 vUv;\n\nvoid main() {\n  vec4 baseColor = texture2D( tSource, vUv );\n\n  if (enabled) {\n    float grey = dot(baseColor.rgb, vec3(0.299, 0.587, 0.114));\n    grey = smoothstep(crush, 1.0 - crush, grey);\n\n    vec3 outColor = mix(colorDark, colorLight, grey);\n\n    gl_FragColor = vec4(outColor, 1.0);\n  } else {\n    gl_FragColor = baseColor;\n  }\n}\n"]);return w=function(){return e},e}function j(){var e=Object(u.a)(["\nvarying vec2 vUv;\n\nvoid main() {\n  vUv = uv;\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}\n"]);return j=function(){return e},e}var y=function(){function e(t,a){var i=this;Object(g.a)(this,e),this.canvas=t,this.state=a,this.renderer=void 0,this.scene=void 0,this.camera=void 0,this.controls=void 0,this.adversary=void 0,this.adversaryMaterial=void 0,this.timeStarted=0,this.geom=new f.o(200,200,512,512),this.textureBase=void 0,this.duotoneEffect=void 0,this.ambientLight=void 0,this.directionalLight=void 0,this.pointCloud=void 0,this.handleWindowResize=function(){i.renderer.setSize(window.innerWidth,window.innerHeight),i.camera.aspect=window.innerWidth/window.innerHeight,i.camera.updateProjectionMatrix()},this.animate=function(){var e,t,a,n,r,o;(requestAnimationFrame(i.animate),i.controls.update(),null!=i.adversaryMaterial&&(i.adversaryMaterial.displacementScale=(a=0,n=5e3,r=performance.now()-i.timeStarted,(r=f.i.clamp((r-a)/(n-a),0,1))*r*(3-2*r)*i.state.growLength)),"particles"===i.state.mode)&&(null===(o=i.pointCloud)||void 0===o||o.animate());null===(e=i.duotoneEffect)||void 0===e||e.material.update(i.state),null===(t=i.duotoneEffect)||void 0===t||t.render(i.renderer),i.renderer.render(i.scene,i.camera)},this.renderer=new f.B({canvas:t}),this.renderer.setPixelRatio(window.devicePixelRatio),this.scene=new f.s,this.camera=new f.m(75,window.innerWidth/window.innerHeight,1,2e3),this.camera.position.set(150,0,150),this.camera.lookAt(0,0,0),this.handleWindowResize(),window.addEventListener("resize",this.handleWindowResize),this.ambientLight=new f.a,this.scene.add(this.ambientLight),this.directionalLight=new f.d,this.directionalLight.position.set(0,0,10),this.scene.add(this.directionalLight),this.scene.background=new f.c(1,1,1),this.loadDefaultImage(),this.controls=new p.a(this.camera,this.canvas),this.controls.autoRotate=!0,this.setState(a),requestAnimationFrame(this.animate)}return Object(m.a)(e,[{key:"setImage",value:function(e){var t=new f.w(e);e.onload=function(){t.needsUpdate=!0},this.recreateAdversary(t)}},{key:"setState",value:function(e){var t;this.state=e,null===(t=this.duotoneEffect)||void 0===t||t.material.update(e),null!=this.adversaryMaterial&&(e.duoToneEnabled?this.adversaryMaterial.map=this.duotoneEffect.texture:this.adversaryMaterial.map=this.textureBase,this.adversaryMaterial.needsUpdate=!0),this.ambientLight.color.set(e.ambientLight),this.directionalLight.color.set(e.directionalLight),this.scene.background.set(e.background),"heightmap"===e.mode&&null!=this.adversary&&null==this.adversary.parent?(this.scene.add(this.adversary),this.pointCloud&&this.scene.remove(this.pointCloud)):"particles"===e.mode&&null!=this.pointCloud&&null==this.pointCloud.parent&&(this.scene.add(this.pointCloud),this.adversary&&this.scene.remove(this.adversary))}},{key:"recreateAdversary",value:function(e){var t;null!=this.adversary&&(this.scene.remove(this.adversary),null===(t=this.adversaryMaterial)||void 0===t||t.dispose());null!=this.pointCloud&&this.scene.remove(this.pointCloud),this.textureBase=e,this.duotoneEffect=new x(e,this.state);var a=this.createDisplacementMap(e),i=a.texture,n=a.imageData;this.adversaryMaterial=new f.k({side:f.e,map:this.duotoneEffect.texture,displacementMap:i,displacementScale:0,roughness:1,metalness:0}),this.state.duoToneEnabled?this.adversaryMaterial.map=this.duotoneEffect.texture:this.adversaryMaterial.map=this.textureBase,this.adversary=new f.j(this.geom,this.adversaryMaterial),this.pointCloud=new M(n),"heightmap"===this.state.mode?this.scene.add(this.adversary):this.scene.add(this.pointCloud),this.renderer.render(this.scene,this.camera),this.timeStarted=performance.now()}},{key:"loadDefaultImage",value:function(){var e=this;(new f.x).load("/2005-crowdstrike-adversary/adversaries/Buffalo.jpg",(function(t){e.recreateAdversary(t)}),(function(e){return console.log(e)}),(function(e){return console.error(e)}))}},{key:"createDisplacementMap",value:function(e){var t=e.image,a=document.createElement("canvas");a.width=t.width/15,a.height=t.height/15;var i=a.getContext("2d");if(i){i.drawImage(t,0,0,a.width,a.height);for(var n=a.width,r=a.height,o=i.getImageData(0,0,n,r),s=0;s<o.data.length;s+=4)o.data[s],o.data[s+1],o.data[s+2];return{texture:new f.b(a),imageData:o}}}},{key:"generateDisplacementMappedGeometry",value:function(e){var t=document.createElement("canvas");t.width=e.width/10,t.height=e.height/10;var a=t.getContext("2d");if(a){a.drawImage(e,0,0,t.width,t.height);var i,n=t.width,r=t.height,o=a.getImageData(0,0,n,r),s=new f.o(n-1,r-1,n-1,r-1),c=Object(v.a)(s.vertices);try{for(c.s();!(i=c.n()).done;){var d=i.value,h=4*(f.i.mapLinear(d.x-.5,-n/2,n/2,0,n)+n*f.i.mapLinear(d.y-.5,r/2,-r/2,0,r)),l=.2126*(o.data[h]/255)+.7152*(o.data[h+1]/255)+.0722*(o.data[h+2]/255);d.z=20*l}}catch(g){c.e(g)}finally{c.f()}var u=200/Math.max(n,r);return s.scale(u,u,1),s.computeFlatVertexNormals(),s}}}]),e}(),x=function(){function e(t,a){Object(g.a)(this,e),this.source=t,this.target=void 0,this.fsQuad=void 0,this.material=void 0,this.target=new f.A(t.image.width,t.image.height),this.material=new D(t,a),this.fsQuad=new b.a.FullScreenQuad(this.material)}return Object(m.a)(e,[{key:"texture",get:function(){return this.target.texture}}]),Object(m.a)(e,[{key:"render",value:function(e){e.setRenderTarget(this.target),this.fsQuad.render(e),e.setRenderTarget(null)}}]),e}();function O(e){for(var t="",a=0;a<(arguments.length<=1?0:arguments.length-1);a++)t+=e[a],t+=a+1<1||arguments.length<=a+1?void 0:arguments[a+1];return t+=e[e.length-1]}var L=O(j()),k=O(w()),D=function(e){Object(h.a)(a,e);var t=Object(l.a)(a);function a(e,i){var n;return Object(g.a)(this,a),(n=t.call(this,{uniforms:{tSource:{value:e},colorLight:{value:new f.c(i.duoToneLight)},colorDark:{value:new f.c(i.duoToneDark)},crush:{value:0},enabled:{value:!0}},vertexShader:L,fragmentShader:k})).needsUpdate=!0,n}return Object(m.a)(a,[{key:"update",value:function(e){this.uniforms.colorLight.value.set(e.duoToneLight),this.uniforms.colorDark.value.set(e.duoToneDark),this.uniforms.enabled.value=e.duoToneEnabled,this.needsUpdate=!0}}]),a}(f.t),M=function(e){Object(h.a)(a,e);var t=Object(l.a)(a);function a(e){var i;return Object(g.a)(this,a),(i=t.call(this,function(e){for(var t=new f.g,a=e.width,i=e.height,n=0;n<a;n++)for(var r=0;r<i;r++){var o=f.i.mapLinear(n+.5,0,a,-a/2,a/2),s=f.i.mapLinear(r+.5,0,i,i/2,-i/2),c=4*(n+a*r),d=e.data[c]/255,h=e.data[c+1]/255,l=e.data[c+2]/255,u=50*(.2126*d+.7152*h+.0722*l);t.vertices.push(new f.z(o,s,u)),t.colors.push(new f.c(d,h,l))}var v=200/Math.max(a,i);return t.scale(v,v,1),console.log(t),t}(e),function(){var e=(new f.x).load("/2005-crowdstrike-adversary/textures/disc.png");return new f.q({vertexColors:!0,map:e,transparent:!0,alphaTest:.2,opacity:.5,sizeAttenuation:!0,size:3})}())).imageData=e,i.geom=void 0,i.originalPositions=void 0,i.geom=i.geometry,i.originalPositions=i.geom.vertices.map((function(e){return e.clone()})),i}return Object(m.a)(a,[{key:"animate",value:function(){for(var e=performance.now()/1e3%10<5?"circle":"heightmap",t=new f.z,a=0;a<this.geom.vertices.length;a++){var i=this.geom.vertices[a];if(this.geom.colors[a].multiplyScalar(f.i.randFloat(.98,1/.98)),"heightmap"===e)t.set(this.originalPositions[a].x,this.originalPositions[a].y,this.originalPositions[a].z+1*Math.sin(i.x/4+i.y/7+performance.now()/1e3*.5));else{var n=Math.atan2(this.originalPositions[a].y,this.originalPositions[a].x);t.set(200*Math.cos(n),200*Math.sin(n),this.originalPositions[a].z+30+30*Math.sin(i.x/1+i.y/2+performance.now()/1e3*2.5))}i.lerp(t,.2)}this.geom.colorsNeedUpdate=!0,this.geom.verticesNeedUpdate=!0}}]),a}(f.p);var C=function(e){var t=e.img,a=e.state,o=Object(n.useRef)(),s=r.a.useCallback((function(e){null!=e&&(o.current=new y(e,a))}),[]);return Object(n.useEffect)((function(){null!=o.current&&null!=t&&o.current.setImage(t)}),[t]),Object(n.useEffect)((function(){null!=o.current&&o.current.setState(a)}),[a]),Object(i.jsx)("canvas",{ref:s})},E=(a(262),a(51)),T=a(117),S=function(e){var t=e.onGotImage,a=Object(n.useCallback)((function(e,a,i){e.forEach((function(e){var a=new FileReader;a.onabort=function(){return console.log("file reading was aborted")},a.onerror=function(){return console.log("file reading has failed")},a.onload=function(){var e=document.createElement("img");e.src=a.result,t(e)},a.readAsDataURL(e)}))}),[t]),r=Object(T.a)({onDrop:a,maxFiles:1}),o=r.getRootProps,s=r.getInputProps,c=r.isDragActive;return Object(i.jsxs)("div",Object(E.a)(Object(E.a)({className:"dropzone"},o()),{},{children:[Object(i.jsx)("input",Object(E.a)({},s())),c?Object(i.jsx)("p",{children:"Drop the files here ..."}):Object(i.jsx)("p",{children:"Drag 'n' drop some files here, or click to select files"})]}))};var P=function(){var e=Object(n.useState)(),t=Object(c.a)(e,2),a=t[0],r=t[1],o=Object(n.useState)({mode:"heightmap",background:"#ffffff",growLength:50,ambientLight:"#535353",directionalLight:"#d2d2d2",duoToneEnabled:!0,duoToneLight:"#317671",duoToneDark:"#772E49"}),s=Object(c.a)(o,2),h=s[0],l=s[1];return Object(i.jsxs)("div",{className:"App",children:[Object(i.jsx)(C,{img:a,state:h}),Object(i.jsx)(S,{onGotImage:r}),Object(i.jsxs)(d.f,{data:h,onUpdate:l,children:[Object(i.jsx)(d.e,{path:"mode",label:"Mode",options:["heightmap","particles"]}),Object(i.jsx)(d.b,{path:"background",label:"Background"}),Object(i.jsx)(d.b,{path:"ambientLight",label:"Ambient Light"}),Object(i.jsx)(d.b,{path:"directionalLight",label:"Directional Light"}),Object(i.jsx)(d.d,{path:"growLength",label:"Grow Length",min:0,max:999,step:10}),Object(i.jsxs)(d.c,{closed:!1,title:"Duo Tone",children:[Object(i.jsx)(d.a,{path:"duoToneEnabled",label:"Duo Tone Enabled?"}),Object(i.jsx)(d.b,{path:"duoToneLight",label:"Duo Tone Light"}),Object(i.jsx)(d.b,{path:"duoToneDark",label:"Duo Tone Dark"})]})]})]})},z=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,264)).then((function(t){var a=t.getCLS,i=t.getFID,n=t.getFCP,r=t.getLCP,o=t.getTTFB;a(e),i(e),n(e),r(e),o(e)}))};s.a.render(Object(i.jsx)(r.a.StrictMode,{children:Object(i.jsx)(P,{})}),document.getElementById("root")),z()}},[[263,1,2]]]);
//# sourceMappingURL=main.2cce02ec.chunk.js.map